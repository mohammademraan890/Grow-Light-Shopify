{% layout none %}
{% paginate search.results by 1000 %}
    [{%- comment %}<locksmith:d59d>{% endcomment -%}{%- assign locksmith_5a62_forloop__size = 0 %}{% for item in search.results %}{% capture var %}{% render 'locksmith-variables', scope: 'subject', subject: item, subject_parent: search, variable: 'transparent' %}{% endcapture %}{% if var == 'true' %}{% assign locksmith_5a62_forloop__size = locksmith_5a62_forloop__size | plus: 1 %}{% endif %}{% endfor %}{% assign locksmith_5a62_forloop__index = nil -%}{%- comment %}</locksmith:d59d>{% endcomment -%}{% for item in search.results %}
        {%- comment %}<locksmith:10d9>{% endcomment -%}
          {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: item, subject_parent: search, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% if locksmith_5a62_forloop__index == nil %}{% assign locksmith_5a62_forloop__index = 1 %}{% assign locksmith_5a62_forloop__index0 = 0 %}{% else %}{% assign locksmith_5a62_forloop__index = locksmith_5a62_forloop__index | plus: 1 %}{% assign locksmith_5a62_forloop__index0 = locksmith_5a62_forloop__index0 | plus: 1 %}{% endif %}{% if locksmith_5a62_forloop__index == 1 %}{% assign locksmith_5a62_forloop__first = true %}{% else %}{% assign locksmith_5a62_forloop__first = false %}{% endif %}{% if locksmith_5a62_forloop__index == locksmith_5a62_forloop__size %}{% assign locksmith_5a62_forloop__last = true %}{% else %}{% assign locksmith_5a62_forloop__last = false %}{% endif %}{% assign locksmith_5a62_forloop__rindex = locksmith_5a62_forloop__size | minus: locksmith_5a62_forloop__index | minus: 1 %}{% assign locksmith_5a62_forloop__rindex0 = locksmith_5a62_forloop__size | minus: locksmith_5a62_forloop__index0 | minus: 1 %}{% else %}{% continue %}{% endif -%}
        {%- comment %}</locksmith:10d9>{% endcomment -%}
        {
            "id": {{ item.id | json }},
            "title": {{ item.title | json }},
            "tags": {{ item.tags | json }},
            "handle": {{ item.handle | json }},
            "metafields": {
                "shopify": {{ item.metafields.shopify | json }},
                "custom": {{ item.metafields.custom | json }}
            },
            "featureImage": {{ item.featured_image | json }},
            "variantsCount": {{ item.variants_count | json }},
            "variants": [{% for variant in item.variants %}
                {% assign price_breaks_json = "" %}
                {% if variant.quantity_price_breaks.size > 0 %}
                    {% for price_break in variant.quantity_price_breaks %}
                        {% assign item_json = 
                        '{ "minimum_quantity": ' | append: price_break.minimum_quantity | 
                        append: ', "price": ' | append: price_break.price | append: ' }' %}
                        {% assign price_breaks_json = price_breaks_json | append: item_json %}
                        {% unless forloop.last %}
                        {% assign price_breaks_json = price_breaks_json | append: ',' %}
                        {% endunless %}
                    {% endfor %}
                {% endif %}
                {
                    "id": {{ variant.id | json }},
                    "image": {{ variant.image.src | json }},
                    "inventory_management": {{ variant.inventory_management | json }},
                    "inventory_policy": {{ variant.inventory_policy | json }},
                    "inventory_quantity": {{ variant.inventory_quantity | json }},
                    "metafields": {
                        "shopify": {{ variant.metafields.shopify | json }},
                        "custom": {{ variant.metafields.custom | json }}
                    },
                    "title": {{ variant.title | json }},
                    "sku": {{ variant.sku | json }},
                    "barcode": {{ variant.barcode | json }},
                    "price": {{ variant.price | json }},
                    "taxable": {{ variant.taxable | json }},
                    "compare_at_price": {{ variant.compare_at_price | json }},
                    "available": {{ variant.available | json }},
                    "unit_price": {{ variant.unit_price | json }},
                    "base_measure": {{ variant.unit_price_measurement.reference_value | json }},
                    "requires_shipping": {{ variant.requires_shipping | json }},
                    "quantity_value" : {{ variant.unit_price_measurement.quantity_value | json }},
                    "weight": {{ variant.weight | json }},
                    "quantity_price_breaks": [{% if price_breaks_json != "" %}{{ price_breaks_json }}{% endif %}],
                    "quantity_rule": {{ variant.quantity_rule | json }}
                }{% unless forloop.last %},{% endunless %}
            {% endfor %}],
            "available": {{ item.available | json }},
            "compare_at_price_max": {{ item.compare_at_price_max | json }},
            "compare_at_price_min": {{ item.compare_at_price_min | json }},
            "price": {{ item.price | json }},
            "price_max": {{ item.price_max | json }},
            "price_min": {{ item.price_min | json }},
            "type": {{ item.type | json }},
            "vendor": {{ item.vendor | json }},
            "description": {{ item.description | json }},
            "collections": [{% for collection in item.collections %}
                {{ collection.id }}{% unless forloop.last %},{% endunless %}
            {% endfor %}]
        }{% unless locksmith_5a62_forloop__last %},{% endunless %}
    {% endfor %}]
{% endpaginate %}

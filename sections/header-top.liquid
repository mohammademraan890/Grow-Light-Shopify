{%- style -%}
     :root {
       --header-bg: {{ section.settings.header_bg }};
       --header-border: {{ section.settings.header_border }};
       --nav-border: {{ section.settings.nav_border }};
       --text-color: {{ section.settings.text_color }};
       --accent-color: {{ section.settings.accent_color }};
       --bottom-bg: {{ section.settings.bottom_bg }};

       /* âœ… Bottom header variables (FIX) */
       --bottom-bg: {{ section.settings.bottom_bg }};
       --bottom-text: {{ section.settings.bottom_text }};
       --bottom-link: {{ section.settings.bottom_link }};
     }

     .site-header {
       background: var(--header-bg);
       color: var(--text-color);
     }

     .header-top-inner {
       border-bottom: 1px solid var(--header-border);
     }

     .nav-menu {
       border-bottom: 1px solid var(--nav-border);
     }

    .header-btm {
       background: var(--bottom-bg);
       color: var(--bottom-text);
       position: relative;
     }

     .header-btm a {
       color: var(--bottom-link) !important;
     }

     /* Swiper arrows */
     .btm-swiper .swiper-button-prev,
     .btm-swiper .swiper-button-next {
       color: #000;
       width: 28px;
       height: 28px;
     }

     .btm-swiper .swiper-button-prev::after,
     .btm-swiper .swiper-button-next::after {
       font-size: 18px;
       font-weight: bold;
     }

     /* Desktop: disable swiper layout */
     @media (min-width: 768px) {
       .btm-swiper {
         overflow: visible;
       }
       .btm-swiper .swiper-wrapper {
         display: grid;
         grid-template-columns: repeat(2, 1fr);
         transform: none !important;
       }
       .btm-swiper .swiper-slide {
         width: auto !important;
       }
       .btm-swiper .swiper-button-prev,
       .btm-swiper .swiper-button-next {
         display: none;
       }
     }
     /* Scroll animation helpers */
  /* HEADER BASE */
  /* HEADER BASE */
  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
  }

  /* NAV MENU ALWAYS FIXED */
  .nav-menu {
    position: sticky;
    top: 0;
    background: var(--header-bg);
    z-index: 50;
    transition: box-shadow 0.3s ease;
  }

  /* Animate hide sections */
  .header-top-inner,
  .header-btm {
    transition: opacity 0.35s ease, transform 0.35s ease, max-height 0.35s ease;
    transform: translateY(0);
    opacity: 1;
    max-height: 300px;
    overflow: hidden;
  }

  /* COLLAPSED STATE */
  .site-header.is-collapsed .header-top-inner,
  .site-header.is-collapsed .header-btm {
    opacity: 0;
    transform: translateY(-20px);
    max-height: 0;
    pointer-events: none;
    padding: 0 !important;
  }

  /* Nav shadow when collapsed */
  .site-header.is-collapsed .nav-menu {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  @media (max-width: 1200px) {
    .desktop-header-wrapper {
      display: none;
    }
  }
{%- endstyle -%}
<div class="h-[230px]  desktop-header-wrapper">
  <header class="site-header fixed z-100  top-0 left-0 right-0 bg-white">
    {%- if section.settings.show_top_bar -%}
      <div class="header-top-inner">
        <div class="custom-container">
          <div class="flex items-center gap-10">
            {%- if section.settings.logo_position == 'left' -%}
              <a href="/" class="header-logo rounded-full!">
                <img
                  src="{{ 'grow-light-logo.webp' | asset_url }}"
                  alt="{{ shop.name }}"
                  width="{{ section.settings.logo_width }}"
                >
              </a>
            {%- endif -%}

            <div class="header-left flex flex-col gap-[20px] w-full">
              <!-- TOP INFO BAR -->
              <div class="border-b border-[#e9e9e9] py-[10px] flex justify-between text-[12px] items-center w-full">
                <div class="flex items-center gap-5">
                  <a href="mailto:support@growlightheaven.com" class="header-link"> support@growlightheaven.com </a>
                  <a href="tel:9142196983" class="header-link"> (914) 219-6983 </a>
                  <span>Mon-Fri: 9AM - 5PM EST</span>
                </div>

                <div class="flex items-center gap-5">
                  <a href="#" class="header-link">Commercial Pricing</a>
                  <a href="#" class="header-link">Get Rebates</a>
                  <a href="#" class="header-link">Facility Design</a>
                </div>
              </div>

              <!-- SEARCH + ICONS -->
              <div class="flex items-center mb-4 gap-10">
                <div class="w-full flex items-center gap-2 border border-[#959595] rounded-sm focus-within:shadow-[0_0_0_3px_#4140421a]">
                  <input
                    placeholder="What are you looking for?"
                    class="w-full py-2.5 px-5 text-[14px] focus:outline-none"
                    type="text"
                  >
                  <button class="w-[40px] flex items-center justify-center cursor-pointer">
                    {% render 'svg-icons', name: 'search-icon' %}
                  </button>
                </div>

                <div class="flex items-center gap-10 text-[12px]">
                  {% if customer %}
                    <a href="{{ routes.account_url }}" class="flex items-center flex-col group">
                      {% render 'svg-icons',
                        name: 'user-icon',
                        icon_class: 'fill-[#414042] group-hover:fill-[#006A2E]'
                      %}
                      <span class="group-hover:underline whitespace-nowrap">Profile</span>
                    </a>

                    <a href="{{ routes.account_logout_url }}" class="flex items-center flex-col group">
                      <img
                        src="{{ 'logout.png' | asset_url }}"
                        alt="Logout"
                        class="w-[20px] h-auto"
                      >
                      <span class="group-hover:underline whitespace-nowrap">Logout</span>
                    </a>

                  {% else %}
                    <a href="{{ routes.account_login_url }}" class="flex items-center flex-col group">
                      {% render 'svg-icons',
                        name: 'user-icon',
                        icon_class: 'fill-[#414042] group-hover:fill-[#006A2E]'
                      %}
                      <span class="group-hover:underline whitespace-nowrap">Sign In</span>
                    </a>
                  {% endif %}

                  <a href="#" class="flex items-center flex-col group">
                    {% render 'svg-icons',
                      name: 'wishlist-icon',
                      icon_class: 'fill-[#414042] group-hover:fill-[#006A2E]'
                    %}
                    <span class="group-hover:underline whitespace-nowrap">My Wishlist</span>
                  </a>
                  <a href="{{ routes.cart_url }}" class="flex items-center flex-col group relative">
                    {% render 'svg-icons', name: 'cart-icon', icon_class: 'fill-[#414042] group-hover:fill-[#006A2E]' %}
                    <span class="group-hover:underline whitespace-nowrap">My Cart</span>
                    <span class="cart-count absolute top-[-12px] right-[-5px] bg-(--color-primary) text-white text-[11px] leading-0 font-light min-h-[20px] p-1 min-w-[20px] flex items-center justify-center rounded-full">
                      {{- cart.item_count -}}
                    </span>
                  </a>
                </div>
              </div>
            </div>

            {%- if section.settings.logo_position == 'right' -%}
              <a href="/" class="header-logo">
                <img
                  src="{{ 'grow-light-logo.webp' | asset_url }}"
                  alt="{{ shop.name }}"
                  width="{{ section.settings.logo_width }}"
                >
              </a>
            {%- endif -%}
          </div>
        </div>
      </div>
    {%- endif -%}

    <!-- NAVIGATION -->
    <div class="nav-menu bg-white relative">
      <div class="custom-container">
        <ul class="flex items-center justify-between text-[16px] font-medium text-[#414042]">
          {% for link in linklists['nav-menu'].links %}
            {%- comment %}<locksmith:e84f>{% endcomment -%}
              {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: link, subject_parent: linklists.nav-menu, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
            {%- comment %}</locksmith:e84f>{% endcomment -%}
            <li class=" group">
              <!-- Parent link -->
              <a
                href="{{ link.url }}"
                class="block px-2 py-3 hover:text-[#006A2E]! transition-colors duration-200"
              >
                {{ link.title }}
              </a>

              {% if link.links != blank %}
                <!-- Mega Menu -->
                <div
                  class="
                    absolute left-0 top-full w-screen bg-white border-t border-[#006A2E]
                    opacity-0 invisible group-hover:opacity-100 group-hover:visible
                    transition-all duration-200 z-50 shadow-lg
                  "
                >
                  <div class="custom-container py-8!">
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-8">
                      <div class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-8">
                        {% for child in link.links %}
                          {%- comment %}<locksmith:448c>{% endcomment -%}
                            {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: child, subject_parent: link, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
                          {%- comment %}</locksmith:448c>{% endcomment -%}
                          <div>
                            <a
                              href="{{ child.url }}"
                              class="block text-[14px]! font-medium! text-[#414042]! mb-1 hover:underline!"
                            >
                              {{ child.title }}
                            </a>
                            {% if child.links != blank %}
                              <ul class="space-y-2">
                                {% for grandchild in child.links %}
                                  {%- comment %}<locksmith:74ae>{% endcomment -%}
                                    {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: grandchild, subject_parent: child, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
                                  {%- comment %}</locksmith:74ae>{% endcomment -%}
                                  <li>
                                    <a
                                      href="{{ grandchild.url }}"
                                      class="text-[12px] font-normal! text-[#414042] hover:underline!"
                                    >
                                      {{ grandchild.title }}
                                    </a>
                                  </li>
                                {% endfor %}
                              </ul>
                            {% endif %}
                          </div>
                        {% endfor %}
                      </div>

                      <div class="md:col-span-2">
                        {% for block in section.blocks %}
                          {% assign menu_item_handle = link.title | handle %}
                          {% assign target_menu_handle = block.settings.menu_item | handle %}

                          {% if menu_item_handle == target_menu_handle %}
                            {% assign featured_col = block.settings.collection %}
                            {% if featured_col != blank %}
                              <a
                                href="{{ featured_col.url }}"
                                class=" relative block w-full h-full overflow-hidden"
                              >
                                {% if featured_col.featured_image %}
                                  <img
                                    src="{{ featured_col.featured_image | image_url: width: 600 }}"
                                    alt="{{ featured_col.title }}"
                                    class="absolute  w-full h-full object-contain"
                                  >
                                {% else %}
                                  <div class="absolute inset-0 bg-gray-200 flex items-center justify-center">
                                    No Image
                                  </div>
                                {% endif %}

                                <div class="absolute inset-0 flex items-center justify-center p-4">
                                  <h3 class="text-[#414042] text-[15px] font-normal  text-center leading-tight tracking-wider">
                                    {{ featured_col.title }}
                                  </h3>
                                </div>
                              </a>
                            {% endif %}
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    {%- if section.settings.show_bottom_bar -%}
      <div class="header-btm py-2.5">
        <div class="custom-container relative">
          <div class="swiper btm-swiper" id="bottomBarSwiper">
            <div class="swiper-wrapper text-center">
              <div class="swiper-slide">
                <p class="text-[16px] font-medium">
                  {{ section.settings.bottom_title_1 }}
                </p>
                <p class="text-[14px]">
                  {{ section.settings.bottom_text_1 }}
                  <a href="tel:{{ section.settings.bottom_phone_1 | replace: ' ', '' }}">
                    {{ section.settings.bottom_phone_1 }}
                  </a>
                </p>
              </div>

              <div class="swiper-slide">
                <p class="text-[16px] font-medium">
                  {{ section.settings.bottom_title_2 }}
                </p>
                <p class="text-[14px]">
                  {{ section.settings.bottom_text_2 }}
                  <a href="tel:{{ section.settings.bottom_phone_2 | replace: ' ', '' }}">
                    {{ section.settings.bottom_phone_2 }}
                  </a>
                </p>
              </div>
            </div>

            <!-- Arrows -->
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
          </div>
        </div>
      </div>
    {%- endif -%}
  </header>
</div>
{% schema %}
{
  "name": "Custom Header",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_top_bar",
      "label": "Show top header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_bottom_bar",
      "label": "Show bottom bar",
      "default": true
    },
    {
      "type": "select",
      "id": "logo_position",
      "label": "Logo position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "Logo width (px)",
      "min": 60,
      "max": 200,
      "step": 10,
      "default": 100
    },

    {
      "type": "color",
      "id": "header_bg",
      "label": "Header background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "header_border",
      "label": "Header border color",
      "default": "#E9E9E9"
    },
    {
      "type": "color",
      "id": "nav_border",
      "label": "Navigation border color",
      "default": "#006A2E"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#414042"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent / hover color",
      "default": "#006A2E"
    },
    {
      "type": "header",
      "content": "Bottom Bar Settings"
    },
    {
      "type": "color",
      "id": "bottom_bg",
      "label": "Bottom bar background",
      "default": "#F4F4F4"
    },
    {
      "type": "color",
      "id": "bottom_text",
      "label": "Bottom bar text color",
      "default": "#414042"
    },
    {
      "type": "color",
      "id": "bottom_link",
      "label": "Bottom bar link color",
      "default": "#36895A"
    },
    {
      "type": "text",
      "id": "bottom_title_1",
      "label": "Slide 1 title",
      "default": "Commercial Grower?"
    },
    {
      "type": "text",
      "id": "bottom_text_1",
      "label": "Slide 1 text",
      "default": "For commercial pricing:"
    },
    {
      "type": "text",
      "id": "bottom_phone_1",
      "label": "Slide 1 phone",
      "default": "(914) 219-6983"
    },
    {
      "type": "text",
      "id": "bottom_title_2",
      "label": "Slide 2 title",
      "default": "Commercial Grower?"
    },
    {
      "type": "text",
      "id": "bottom_text_2",
      "label": "Slide 2 text",
      "default": "For commercial pricing:"
    },
    {
      "type": "text",
      "id": "bottom_phone_2",
      "label": "Slide 2 phone",
      "default": "(914) 219-6983"
    }
  ],
  "blocks": [
    {
      "type": "mega_menu_featured",
      "name": "Mega Menu Promotion",
      "settings": [
        {
          "type": "text",
          "id": "menu_item",
          "label": "Menu Item Name",
          "info": "Type the exact name of the parent link this image should appear under (e.g. 'Shop')"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Featured Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Header"
    }
  ]
}
{% endschema %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    let bottomSwiper;

    function initBottomSwiper() {
      if (window.innerWidth < 768 && !bottomSwiper) {
        bottomSwiper = new Swiper('#bottomBarSwiper', {
          slidesPerView: 1,
          loop: true,
          autoplay: {
            delay: 3000,
            disableOnInteraction: false,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      }

      if (window.innerWidth >= 768 && bottomSwiper) {
        bottomSwiper.destroy(true, true);
        bottomSwiper = null;
      }
    }

    initBottomSwiper();
    window.addEventListener('resize', initBottomSwiper);
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const header = document.querySelector('.site-header');

    let lastScrollY = window.scrollY;
    let scrollUpStart = null;

    const triggerOffset = 150;
    const scrollUpThreshold = 10;

    window.addEventListener('scroll', () => {
      const currentScrollY = window.scrollY;

      // SCROLL DOWN
      if (currentScrollY > lastScrollY && currentScrollY > triggerOffset) {
        header.classList.add('is-collapsed');
        scrollUpStart = null; // reset
      }

      // SCROLL UP
      if (currentScrollY < lastScrollY) {
        if (scrollUpStart === null) {
          scrollUpStart = lastScrollY;
        }

        if (scrollUpStart - currentScrollY >= scrollUpThreshold) {
          header.classList.remove('is-collapsed');
          scrollUpStart = null; // reset after expand
        }
      }

      // NO MOVEMENT
      if (currentScrollY === lastScrollY) {
        scrollUpStart = null;
      }

      lastScrollY = currentScrollY;
    });
  });
</script>
